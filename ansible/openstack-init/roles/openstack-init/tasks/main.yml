---    - name: get old hostname      shell: hostname      register: host    - name: change hostname      shell: hostname {{ item }}      with_items: host.stdout + '.yottaa.com'      when:  host.stdout.endswith('yottaa.com') != True    - name: change network file      shell: sed -i 's/novalocal/yottaa.com/g' /etc/sysconfig/network    - name: generate /etc/hosts file      template: src=hosts.j2  dest=/etc/hosts owner=root group=root    - name: collect public ip      shell: curl  http://169.254.169.254/latest/meta-data/public-ipv4      register: public_ip    - name: generate /etc/company.facts file      template: src=company.facts.j2 dest=/etc/company.facts  owner=root group=root    - name: copy puppet-products repo file      copy: src=yottaa-puppet-products.repo  dest=/etc/yum.repos.d/yottaa-puppet-products.repo owner=root group=root    - name: copy puppet-dependencies repo file      copy: src=yottaa-puppet-dependencies.repo  dest=/etc/yum.repos.d/yottaa-puppet-dependencies.repo  owner=root group=root    - name:  install puppet      yum : name={{ item }} state=present      with_items:         - ruby         - facter         - hiera         - puppet         - screen    - name: copy csr_attributes files      copy: src=csr_attributes.yaml  dest=/etc/puppet/csr_attributes.yaml    owner=root group=root    - name: make sure yadmin user exist      user: name=yadmin state=present shell=/bin/bash  home=/home/yadmin    - name: make /home/yadmin/bin directory exist      file: src=/home/yadmin/bin  state=directory  owner=yadmin    - name: run puppet agent -t  on screen      shell: echo "puppet agent --test --server repo.yottaa.com --environment stage --pluginsync true --waitforcert 10 --certname {{ item }} " >/tmp/puppet      with_items: host.stdout + '.yottaa.com'      when:  host.stdout.endswith('yottaa.com') != True    - name: run /tmp/puppet script      shell: screen -dmS puppet sh /tmp/puppet  creates=/var/lib/puppet/lib/facter/company.rb      